<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Chatbot C·∫¢NH B√ÅO NGUY C∆† ONLINE ‚Äî Anti-Scam & Safety</title>
<style>
/* UI (kept same as your style) */
*{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
:root{
  --bg:#0b0b0c;
  --panel:#0f1113;
  --muted:#9aa3ad;
  --accent:#00e6ff;
  --accent-2:#00b3ff;
  --danger:#ff6b6b;
  --danger-2:#ff3b3b;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#060708 0%, #050506 100%);color:#e6eef3}
.app{height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.shell{width:100%;max-width:980px;height:86vh;background:var(--panel);border-radius:12px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.03)}
.logo{display:flex;gap:12px;align-items:center}
.logo .dot{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#001;font-weight:700}
.title{font-weight:600}
.controls{display:flex;gap:10px;align-items:center;color:var(--muted)}
.body{display:flex;flex:1;overflow:hidden}
.sidebar{width:260px;border-right:1px solid rgba(255,255,255,0.03);padding:12px 14px;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent)}
.sidebar h3{margin:8px 0;color:var(--accent)}
.sidebar p{font-size:13px;color:var(--muted);line-height:1.4}
.main{flex:1;display:flex;flex-direction:column}
.chat{flex:1;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent)}
.msg{max-width:72%;padding:12px 14px;border-radius:12px;line-height:1.45;word-break:break-word}
.msg.user{align-self:flex-end;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001;border-bottom-right-radius:4px}
.msg.bot{align-self:flex-start;background:#0b0d0f;border:1px solid rgba(0,230,255,0.06);color:#dff8ff}
.typing{display:inline-flex;gap:6px;align-items:center}
.typing span{width:7px;height:7px;background:var(--muted);border-radius:50%;display:inline-block;animation:blink 1s infinite}
.typing span:nth-child(2){animation-delay:0.15s}
.typing span:nth-child(3){animation-delay:0.3s}
@keyframes blink{50%{opacity:0.2;transform:translateY(-4px)}}
.footer{padding:12px 18px;border-top:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:10px;background:linear-gradient(180deg,transparent, rgba(255,255,255,0.02))}
.inputRow{display:flex;gap:10px;align-items:center}
.input{flex:1;display:flex;align-items:center;background:#0b0d0f;border-radius:10px;padding:8px;border:1px solid rgba(255,255,255,0.02)}
.input input{flex:1;border:0;background:transparent;color:#e8f9ff;padding:8px;font-size:15px;outline:none}
.sendBtn{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;padding:10px 14px;border-radius:10px;color:#002;font-weight:700;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.footer-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
.centerNote{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px}
#startupOverlay{position:fixed;inset:0;background:linear-gradient(180deg,#00151a,#000);display:flex;align-items:center;justify-content:center;z-index:10000}
.startPanel{width:460px;background:linear-gradient(180deg,#071319,#051013);border-radius:12px;padding:26px;border:1px solid rgba(0,255,255,0.06);box-shadow:0 8px 40px rgba(0,0,0,0.6);text-align:center}
.startPanel h2{color:var(--accent);margin-bottom:12px}
.startBtn{background:var(--accent);border:0;color:#002;padding:10px 18px;border-radius:8px;font-weight:700;cursor:pointer}
.loadWrap{margin-top:18px;display:none;flex-direction:column;align-items:center}
.bar{width:100%;height:10px;background:#0b0d0f;border-radius:8px;overflow:hidden;margin-top:8px}
.barInner{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .12s linear}
.percent{margin-top:8px;color:var(--muted)}

/* emergency popup */
#emergPopup{position:fixed;left:50%;top:12%;transform:translateX(-50%);width:88%;max-width:520px;background:linear-gradient(180deg,var(--danger),var(--danger-2));color:#fff;padding:16px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.6);z-index:20000;display:none;border:2px solid rgba(255,255,255,0.08)}
#emergPopup h3{margin:0 0 8px;font-size:18px}
#emergPopup p{margin:0 0 12px;font-size:14px}
#emergPopup .ep-actions{display:flex;gap:8px;justify-content:flex-end}
.ep-btn{background:rgba(0,0,0,0.12);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
.ep-btn.call{background:#fff;color:#b30000}

/* small screens */
@media (max-width:880px){.shell{max-width:100%;height:100vh;border-radius:0}.sidebar{display:none}}
</style>
</head>
<body>
<div class="app">
  <div class="shell" role="application" aria-label="Chatbot C·∫£nh B√°o">
    <div class="header">
      <div class="logo"><div class="dot">AI</div><div class="title">Chatbot C·∫¢NH B√ÅO NGUY C∆† ONLINE</div></div>
      <div class="controls small">Demo ‚Ä¢ Offline ‚Ä¢ Dark</div>
    </div>

    <div class="body">
      <aside class="sidebar">
        <h3>V·ªÅ Chatbot</h3>
        <p>H·ªó tr·ª£ nh·∫≠n di·ªán l·ª´a ƒë·∫£o, ph·∫£n ·ª©ng an to√†n, x·ª≠ l√Ω t√¨nh hu·ªëng nguy hi·ªÉm v√† h∆∞·ªõng d·∫´n b√°o c√°o.</p>
        <h3>Li√™n h·ªá kh·∫©n</h3>
        <p class="small">S·ªë kh·∫©n c·∫•p (VD Vi·ªát Nam):<br>113 ‚Äî C√¥ng an / 114 ‚Äî C·ª©u ho·∫£ / 115 ‚Äî C·∫•p c·ª©u</p>
      </aside>

      <main class="main" id="mainArea">
        <section class="chat" id="chatArea" aria-live="polite"></section>

        <div class="footer">
          <div class="inputRow">
            <div class="input" role="search">
              <input id="userInput" placeholder="Nh·∫≠p t√¨nh hu·ªëng nguy hi·ªÉm ho·∫∑c c√¢u h·ªèi v·ªÅ l·ª´a ƒë·∫£o, tr·ªôm, b·∫Øt c√≥c, tai n·∫°n..." aria-label="Nh·∫≠p c√¢u h·ªèi" />
            </div>
            <button class="sendBtn" id="sendBtn" title="G·ª≠i">G·ª¨I</button>
          </div>

          <div class="footer-row">
            <div class="centerNote small">D√†nh cho h·ªçc sinh THCS ‚Äî N·∫øu nguy hi·ªÉm th·ª±c s·ª±, g·ªçi ngay s·ªë kh·∫©n c·∫•p ƒë·ªãa ph∆∞∆°ng <ƒê∆∞·ª£c ph√°t tri·ªÉn b·ªüi Mduc>.</div>
            <div>
              <button id="contactBtn" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:8px;color:var(--accent)">Li√™n h·ªá</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>

<!-- startup overlay -->
<div id="startupOverlay" role="dialog" aria-modal="true">
  <div class="startPanel" role="document">
    <h2>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Chatbot C·∫¢NH B√ÅO NGUY C∆† ONLINE</h2>
    <p class="small">H·ªó tr·ª£ nh·∫≠n di·ªán l·ª´a ƒë·∫£o & h∆∞·ªõng d·∫´n ph·∫£n ·ª©ng an to√†n</p>
    <div style="margin-top:14px">
      <button id="startButton" class="startBtn">Kh·ªüi ƒë·ªông</button>
    </div>
    <div class="loadWrap" id="loadWrap">
      <div class="bar"><div class="barInner" id="barInner"></div></div>
      <div class="percent" id="percentText">0%</div>
    </div>
  </div>
</div>

<!-- emergency popup -->
<div id="emergPopup" role="alert" aria-live="assertive">
  <h3 id="epTitle">C·∫¢NH B√ÅO KH·∫®N C·∫§P</h3>
  <p id="epMsg">Ph√°t hi·ªán t√¨nh hu·ªëng nghi√™m tr·ªçng.</p>
  <div class="ep-actions">
    <button class="ep-btn" id="epClose">ƒê√≥ng</button>
    <button class="ep-btn call" id="epCall">G·ªçi 113</button>
  </div>
</div>

<script>
/* ====== Config & data ====== */
const chatArea = document.getElementById('chatArea');
const inputEl = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const contactBtn = document.getElementById('contactBtn');
const startButton = document.getElementById('startButton');
const loadWrap = document.getElementById('loadWrap');
const barInner = document.getElementById('barInner');
const percentText = document.getElementById('percentText');
const startupOverlay = document.getElementById('startupOverlay');
const emergPopup = document.getElementById('emergPopup');
const epTitle = document.getElementById('epTitle');
const epMsg = document.getElementById('epMsg');
const epClose = document.getElementById('epClose');
const epCall = document.getElementById('epCall');

const CHAT_KEY = 'chatbot_anti_scam_history_final_v1';

/* Forbidden / Emergency keywords */
const forbiddenKeywords = ["hack","hacking","ddos","malware","virus","exploit","cheat","crack","keygen"];
const emergencyKeywords = {
  scam: ["l·ª´a ƒë·∫£o","phishing","scam","email gi·∫£ m·∫°o","web gi·∫£ m·∫°o","tin nh·∫Øn l·ª´a","tr√∫ng th∆∞·ªüng"],
  theft: ["tr·ªôm","c∆∞·ªõp","ƒë·ªôt nh·∫≠p","b·ªã tr·ªôm","ƒÉn tr·ªôm","tr·ªôm ƒë·ªôt nh·∫≠p"],
  kidnap: ["b·∫Øt c√≥c","b·ªã b·∫Øt c√≥c","theo d√µi","b·ªã theo d√µi","b·∫Øt c√≥c tr·∫ª em","b·ªã k√©o ƒëi"],
  threat: ["ƒëe d·ªça","ƒëe d·ªça t√≠nh m·∫°ng","tin nh·∫Øn ƒëe d·ªça","b·ªã d·ªça"],
  accident: ["tai n·∫°n","c·∫•p c·ª©u","b·ªã th∆∞∆°ng","ng√£","ch·∫•n th∆∞∆°ng","tai n·∫°n giao th√¥ng"]
};

/* Knowledge snippets (for richer replies) */
const knowledge = {
  scam: `‚ö†Ô∏è L·ª™A ƒê·∫¢O ‚Äî D·∫•u hi·ªáu & c√°ch x·ª≠ l√Ω:
- D·∫•u hi·ªáu: Y√™u c·∫ßu OTP, chuy·ªÉn ti·ªÅn, link gi·∫£, domain vi·∫øt sai.
- L√†m ngay: KH√îNG b·∫•m link, KH√îNG cung c·∫•p OTP/password, l∆∞u ch·ª©ng c·ª© (·∫£nh, link), b√°o ph·ª• huynh/ qu·∫£n tr·ªã n·ªÅn t·∫£ng.`,
  theft: `üö® TR·ªòM / C∆Ø·ªöP ‚Äî H√†nh ƒë·ªông kh·∫©n:
1) Gi·ªØ an to√†n: r·ªùi kh·ªèi n∆°i nguy hi·ªÉm, tr√°nh ƒë·ªëi m·∫∑t tr·ª±c ti·∫øp.
2) G·ªçi c√¥ng an (113 ·ªü VN).
3) N·∫øu an to√†n: ghi nh·ªõ, ch·ª•p ·∫£nh/video, m√¥ t·∫£ k·∫ª tr·ªôm, bi·ªÉn s·ªë xe.`,
  kidnap: `üö® NGUY C∆† B·∫ÆT C√ìC ‚Äî H∆∞·ªõng d·∫´n:
1) Nhanh ch√≥ng ƒë·∫øn n∆°i ƒë√¥ng ng∆∞·ªùi, tr√°nh ƒëi m·ªôt m√¨nh.
2) G·ªçi s·ªë kh·∫©n c·∫•p: 113 (VN) ho·∫∑c s·ªë ƒë·ªãa ph∆∞∆°ng.
3) Ghi nh·∫≠n m·ªçi chi ti·∫øt: bi·ªÉn s·ªë, m√¥ t·∫£, h∆∞·ªõng ƒëi. B√°o cha m·∫π/gi√°o vi√™n.`,
  threat: `‚ö†Ô∏è B·ªä ƒêE D·ªåA ‚Äî L∆∞u √Ω:
- Kh√¥ng tr·∫£ l·ªùi k·∫ª ƒëe d·ªça.
- Gi·ªØ nguy√™n ch·ª©ng c·ª©: ch·ª•p m√†n h√¨nh, xu·∫•t file.
- Li√™n h·ªá c√¥ng an n·∫øu b·ªã ƒëe d·ªça nghi√™m tr·ªçng; b√°o ng∆∞·ªùi l·ªõn/nh√† tr∆∞·ªùng.`,
  accident: `üöë TAI N·∫†N / C·∫§P C·ª®U ‚Äî Nhanh ch√≥ng:
1) G·ªçi 115 (VN) ho·∫∑c s·ªë c·∫•p c·ª©u t·∫°i ƒë·ªãa ph∆∞∆°ng.
2) N·∫øu bi·∫øt s∆° c·ª©u: c·∫ßm m√°u, ƒë·∫∑t n·∫°n nh√¢n ·ªü t∆∞ th·∫ø an to√†n; kh√¥ng d·ªãch chuy·ªÉn n·∫°n nh√¢n n·∫øu nghi g√£y x∆∞∆°ng n·∫∑ng.
3) M√¥ t·∫£ v·ªã tr√≠ & t√¨nh tr·∫°ng ch√≠nh x√°c cho nh√¢n vi√™n y t·∫ø.`
};

/* ====== Startup behavior ====== */
startButton.onclick = () => {
  startButton.style.display = 'none';
  loadWrap.style.display = 'flex';
  let p = 0;
  const t = setInterval(()=>{
    p += Math.floor(Math.random()*8)+4;
    if(p>100) p=100;
    barInner.style.width = p + '%';
    percentText.textContent = p + '%';
    if(p>=100){
      clearInterval(t);
      setTimeout(()=>{
        startupOverlay.style.display = 'none';
        appendBot('Xin ch√†o üëã ‚Äî t√¥i l√† Chatbot C·∫¢NH B√ÅO NGUY C∆† ONLINE. N·∫øu t√¨nh hu·ªëng kh·∫©n c·∫•p, g·ªçi ngay s·ªë kh·∫©n c·∫•p ƒë·ªãa ph∆∞∆°ng.');
      }, 350);
    }
  }, 80);
};

/* ====== UI helpers ====== */
function appendUser(text){
  const d = document.createElement('div');
  d.className = 'msg user';
  d.textContent = text;
  chatArea.appendChild(d);
  chatArea.scrollTop = chatArea.scrollHeight;
}
function appendBot(text){
  const d = document.createElement('div');
  d.className = 'msg bot';
  // preserve line breaks
  text.split('\n').forEach((line, i) => {
    d.appendChild(document.createTextNode(line));
    if(i < text.split('\n').length -1) d.appendChild(document.createElement('br'));
  });
  chatArea.appendChild(d);
  chatArea.scrollTop = chatArea.scrollHeight;
}
function showTyping(){
  const el = document.createElement('div');
  el.className = 'msg bot';
  const c = document.createElement('div');
  c.className = 'typing';
  c.innerHTML = '<span></span><span></span><span></span>';
  el.appendChild(c);
  chatArea.appendChild(el);
  chatArea.scrollTop = chatArea.scrollHeight;
  return el;
}

/* ====== Emergency popup (visible + call action) ====== */
function showEmergencyPopup(title, message, suggestedNumber = '113'){
  epTitle.textContent = title || 'C·∫¢NH B√ÅO KH·∫®N C·∫§P';
  epMsg.textContent = message;
  epCall.textContent = `G·ªçi ${suggestedNumber}`;
  emergPopup.style.display = 'block';
  // focus for accessibility
  epClose.focus();
}
function hideEmergencyPopup(){ emergPopup.style.display = 'none'; }

/* ep actions */
epClose.addEventListener('click', ()=> hideEmergencyPopup());
epCall.addEventListener('click', ()=> {
  // attempt to call via tel: (works on mobile). On desktop opens default handler.
  const num = epCall.textContent.replace(/\D/g,'') || '113';
  window.open('tel:' + num, '_self');
});

/* ====== Core message processing ====== */
function isContainingAny(text, arr){
  const low = text.toLowerCase();
  return arr.some(k => low.includes(k));
}

function detectSeverity(text){
  // returns severity and category
  const low = text.toLowerCase();
  if(isContainingAny(low, emergencyKeywords.kidnap)) return {level: 3, cat: 'kidnap'}; // highest
  if(isContainingAny(low, emergencyKeywords.theft)) return {level: 3, cat: 'theft'};
  if(isContainingAny(low, emergencyKeywords.accident)) return {level: 3, cat: 'accident'};
  if(isContainingAny(low, emergencyKeywords.threat)) return {level: 3, cat: 'threat'};
  if(isContainingAny(low, emergencyKeywords.scam)) return {level: 2, cat: 'scam'};
  return {level: 0, cat: null};
}

function handleUserMessage(rawText){
  const text = (rawText || '').trim();
  if(!text) return;
  appendUser(text);
  inputEl.value = '';

  // show typing indicator
  const typingEl = showTyping();

  setTimeout(()=> {
    typingEl.remove();

    const low = text.toLowerCase();

    // forbidden
    if(isContainingAny(low, forbiddenKeywords)){
      appendBot('Xin l·ªói ‚Äî t√¥i kh√¥ng th·ªÉ h·ªó tr·ª£ y√™u c·∫ßu li√™n quan ƒë·∫øn hack/cheat/malware. N·∫øu b·∫°n mu·ªën h·ªçc an to√†n h·ª£p ph√°p, t√¥i c√≥ th·ªÉ g·ª£i √Ω t√†i li·ªáu b·∫£o m·∫≠t v√† t√†i nguy√™n ethical hacking.');
      saveChatToStorage();
      return;
    }

    // severity detection
    const det = detectSeverity(text);

    // immediate rules: url/otp/phone detection
    const urlRegex = /(https?:\/\/[^\s]+)/i;
    const otpRegex = /\b(otp|m√£\s?x√°c|minh|m√£\s?x√°c\s?th·ª±c|m√£\s?x√°c\s?nh·∫≠n|m√£\s?otp)\b/i;
    const phoneRegex = /(\+?\d{8,15})/;
    if(urlRegex.test(text)){
      appendBot('‚ö†Ô∏è Link kh·∫£ nghi ph√°t hi·ªán: KH√îNG b·∫•m v√†o link. L∆∞u l·∫°i b·∫±ng ch·ª©ng (·∫£nh, URL). N·∫øu ƒë√£ b·∫•m, ƒë·ªïi m·∫≠t kh·∫©u, b·∫≠t 2FA v√† b√°o ng∆∞·ªùi l·ªõn.');
      saveChatToStorage();
      return;
    }
    if(otpRegex.test(text)){
      appendBot('‚ö†Ô∏è M√£ OTP/ m√£ x√°c th·ª±c ƒë∆∞·ª£c nh·∫Øc t·ªõi ‚Äî tuy·ªát ƒë·ªëi KH√îNG chia s·∫ª m√£ n√†y v·ªõi b·∫•t k·ª≥ ai.');
      saveChatToStorage();
      return;
    }
    if(phoneRegex.test(text) && /y√™u c·∫ßu|chuy·ªÉn|ƒë√≤i|ƒëe d·ªça|g·ªçi|li√™n h·ªá/.test(low)){
      appendBot('‚ö†Ô∏è S·ªë ƒëi·ªán tho·∫°i l·∫° y√™u c·∫ßu chuy·ªÉn ti·ªÅn/ƒëe d·ªça ‚Äî ch·ª•p l·∫°i, ch·∫∑n s·ªë v√† b√°o cho c∆° quan ch·ª©c nƒÉng.');
      saveChatToStorage();
      return;
    }

    // handle detected emergencies by category with step-by-step guidance
    if(det.level > 0){
      switch(det.cat){
        case 'theft':
          appendBot(knowledge.theft);
          // show emergency popup with call suggestion
          showEmergencyPopup('C·∫¢NH B√ÅO TR·ªòM/C∆Ø·ªöP', 'Ph√°t hi·ªán t·ª´ kh√≥a li√™n quan ƒë·∫øn tr·ªôm/c∆∞·ªõp. N·∫øu b·∫°n ƒëang trong t√¨nh hu·ªëng NGAY B√ÇY GI·ªú ‚Äî g·ªçi 113 ho·∫∑c s·ªë kh·∫©n c·∫•p ƒë·ªãa ph∆∞∆°ng ngay l·∫≠p t·ª©c.', '113');
          break;
        case 'kidnap':
          appendBot(knowledge.kidnap);
          showEmergencyPopup('C·∫¢NH B√ÅO B·∫ÆT C√ìC', 'Ph√°t hi·ªán t·ª´ kh√≥a li√™n quan ƒë·∫øn b·∫Øt c√≥c/theo d√µi. N·∫øu c√≥ nguy c∆° ngay b√¢y gi·ªù ‚Äî h√£y t√¨m n∆°i ƒë√¥ng ng∆∞·ªùi v√† g·ªçi 113 ngay.', '113');
          break;
        case 'threat':
          appendBot(knowledge.threat);
          showEmergencyPopup('C·∫¢NH B√ÅO ƒêE D·ªåA', 'Ph√°t hi·ªán t·ª´ kh√≥a li√™n quan ƒë·∫øn ƒëe d·ªça. L∆∞u ch·ª©ng c·ª© v√† g·ªçi c√¥ng an n·∫øu t√≠nh m·∫°ng b·ªã ƒëe d·ªça.', '113');
          break;
        case 'accident':
          appendBot(knowledge.accident);
          showEmergencyPopup('C·∫¢NH B√ÅO C·∫§P C·ª®U', 'Ph√°t hi·ªán t·ª´ kh√≥a tai n·∫°n/c·∫•p c·ª©u. N·∫øu c√≥ ng∆∞·ªùi b·ªã th∆∞∆°ng n·∫∑ng ‚Äî g·ªçi 115 ngay.', '115');
          break;
        case 'scam':
          appendBot(knowledge.scam);
          break;
        default:
          appendBot('Ph√°t hi·ªán d·∫•u hi·ªáu nguy c∆°. H√£y gi·ªØ an to√†n v√† li√™n h·ªá c∆° quan ch·ª©c nƒÉng n·∫øu c·∫ßn.');
      }
      saveChatToStorage();
      return;
    }

    // If none matched, attempt to provide helpful structured guidance based on keywords
    // Very simple intent heuristics for richer responses:
    if(/m·∫•t t√†i kho·∫£n|b·ªã m·∫•t t√†i kho·∫£n|kh√¥i ph·ª•c t√†i kho·∫£n|b·ªã hack t√†i kho·∫£n/.test(low)){
      appendBot(`üîê Kh√¥i ph·ª•c t√†i kho·∫£n ‚Äî c√°c b∆∞·ªõc:
1) N·∫øu c√≤n truy c·∫≠p: ƒë·ªïi m·∫≠t kh·∫©u ngay v√† b·∫≠t 2FA.
2) Ki·ªÉm tra email/s·ªë ƒëi·ªán tho·∫°i li√™n k·∫øt.
3) Li√™n h·ªá h·ªó tr·ª£ n·ªÅn t·∫£ng, g·ª≠i b·∫±ng ch·ª©ng (·∫£nh, th·ªùi gian, thi·∫øt b·ªã).`);
      saveChatToStorage();
      return;
    }

    if(/tin nh·∫Øn gi·∫£ m·∫°o|sms gi·∫£ m·∫°o|zalo gi·∫£ m·∫°o|facebook gi·∫£ m·∫°o/.test(low)){
      appendBot(`üìµ Tin nh·∫Øn/m·∫°ng x√£ h·ªôi gi·∫£ m·∫°o:
- Kh√¥ng tr·∫£ l·ªùi, ch·∫∑n v√† l∆∞u ch·ª©ng c·ª©.
- N·∫øu y√™u c·∫ßu ti·ªÅn/OTP: KH√îNG l√†m theo, b√°o cho ng∆∞·ªùi l·ªõn v√† n·ªÅn t·∫£ng.`);
      saveChatToStorage();
      return;
    }

    // fallback general help
    appendBot(`M√¨nh ch∆∞a ch·∫Øc ch·∫Øn v·ªÅ t√¨nh hu·ªëng c·ª• th·ªÉ. N·∫øu l√† KH·∫®N C·∫§P ‚Äî g·ªçi s·ªë kh·∫©n c·∫•p ƒë·ªãa ph∆∞∆°ng. B·∫°n mu·ªën h∆∞·ªõng d·∫´n c√°c b∆∞·ªõc an to√†n chung (c√≥/kh√¥ng)?`);
    saveChatToStorage();
  }, 600 + Math.random()*700);
}

/* ====== Event bindings ====== */
sendBtn.addEventListener('click', ()=> handleUserMessage(inputEl.value));
inputEl.addEventListener('keydown', e=> { if(e.key === 'Enter') handleUserMessage(inputEl.value); });

/* contact button (simple open) */
contactBtn.addEventListener('click', ()=> {
  const openZalo = confirm('M·ªü Zalo? (Cancel ƒë·ªÉ m·ªü Facebook)');
  if(openZalo) window.open('https://zalo.me/', '_blank');
  else window.open('https://facebook.com/', '_blank');
});

/* ====== Storage: save / load chat history ====== */
function saveChatToStorage(){
  try{
    const rows = [];
    chatArea.querySelectorAll('.msg').forEach(m=>{
      rows.push({role: m.classList.contains('user') ? 'user' : 'bot', text: m.textContent});
    });
    localStorage.setItem(CHAT_KEY, JSON.stringify(rows));
  }catch(e){ /* ignore storage errors */ }
}
function loadChatFromStorage(){
  try{
    const raw = localStorage.getItem(CHAT_KEY);
    if(!raw) return;
    const rows = JSON.parse(raw);
    rows.forEach(r => {
      if(r.role === 'user') appendUser(r.text);
      else appendBot(r.text);
    });
  }catch(e){}
}
loadChatFromStorage();

/* Accessibility: allow Escape to close emergency popup */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && emergPopup.style.display === 'block') hideEmergencyPopup();
});

/* On mobile, auto focus input when chat loads */
window.addEventListener('load', ()=> {
  setTimeout(()=> {
    try{ inputEl.focus(); }catch(e){}
  }, 400);
});
</script>
</body>
</html>